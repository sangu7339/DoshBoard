<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bug Tracking Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 24px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f7f7f7; }
        h1 { margin-bottom: 8px; color: #333; }
        h2 { color: #555; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .actions a { margin-right: 8px; text-decoration: none; }
        .actions a:hover { text-decoration: underline; }
        .toolbar { margin: 12px 0 20px; }
        .add-btn { background: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; }
        .add-btn:hover { background: #218838; }
        .edit-btn { color: #007bff; }
        .delete-btn { color: #dc3545; }
        .severity-s1 { color: #dc3545; font-weight: bold; }
        .severity-s2 { color: #fd7e14; font-weight: bold; }
        .severity-s3 { color: #28a745; font-weight: bold; }
        .priority-p1 { color: #dc3545; font-weight: bold; }
        .priority-p2 { color: #fd7e14; font-weight: bold; }
        .priority-p3 { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Bug Tracking Dashboard</h1>

    <div class="toolbar">
        <a href="/bugs/add" class="add-btn">+ Add New Bug</a>
    </div>

    <!-- Bug statistics chart -->
    <canvas id="bugChart" width="600" height="240"></canvas>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var stats = /*[[${stats}]]*/ {};
        var chartData = [
            stats.inDev || 0,
            stats.inQA || 0,
            stats.totalLive || 0,
            stats.resolved || 0
        ];

        var ctx = document.getElementById('bugChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['In Dev', 'In QA', 'Total Live', 'Resolved'],
                datasets: [{
                    label: 'Bug Count',
                    data: chartData,
                    backgroundColor: ['#ff6384', '#36a2eb', '#ffcd56', '#4bc0c0']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Bug Status Overview' }
                },
                scales: {
                    y: { beginAtZero: true, ticks: { precision: 0 } }
                }
            }
        });
        /*]]>*/
    </script>

    <hr/>

    <!-- Section: In Dev -->
    <h2>In Development (<span th:text="${#lists.size(inDevBugs)}">0</span>)</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Project</th>
                <th>Bug #</th>
                <th>Issue</th>
                <th>Severity</th>
                <th>Priority</th>
                <th>Remarks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="bug : ${inDevBugs}">
                <td th:text="${bug.id}">1</td>
                <td th:text="${bug.project}">Project</td>
                <td th:text="${bug.bugNumber}">BUG-001</td>
                <td th:text="${bug.issue}">Issue</td>
                <td th:text="${bug.severity}" 
                    th:class="${'severity-' + bug.severity.name().toLowerCase()}">S1</td>
                <td th:text="${bug.priority}"
                    th:class="${'priority-' + bug.priority.name().toLowerCase()}">P1</td>
                <td th:text="${bug.remarks}">Notes</td>
                <td class="actions">
                    <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                    <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                       onclick="return confirm('Delete this bug?');">Delete</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(inDevBugs)}">
                <td colspan="8">No bugs in development.</td>
            </tr>
        </tbody>
    </table>

    <!-- Section: In QA -->
    <h2>In QA (<span th:text="${#lists.size(inQaBugs)}">0</span>)</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Project</th>
                <th>Bug #</th>
                <th>Issue</th>
                <th>Severity</th>
                <th>Priority</th>
                <th>Remarks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="bug : ${inQaBugs}">
                <td th:text="${bug.id}">1</td>
                <td th:text="${bug.project}">Project</td>
                <td th:text="${bug.bugNumber}">BUG-002</td>
                <td th:text="${bug.issue}">Issue</td>
                <td th:text="${bug.severity}"
                    th:class="${'severity-' + bug.severity.name().toLowerCase()}">S2</td>
                <td th:text="${bug.priority}"
                    th:class="${'priority-' + bug.priority.name().toLowerCase()}">P2</td>
                <td th:text="${bug.remarks}">Notes</td>
                <td class="actions">
                    <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                    <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                       onclick="return confirm('Delete this bug?');">Delete</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(inQaBugs)}">
                <td colspan="8">No bugs in QA.</td>
            </tr>
        </tbody>
    </table>

    <!-- Section: Resolved -->
    <h2>Resolved (<span th:text="${#lists.size(resolvedBugs)}">0</span>)</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Project</th>
                <th>Bug #</th>
                <th>Issue</th>
                <th>Severity</th>
                <th>Priority</th>
                <th>Remarks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="bug : ${resolvedBugs}">
                <td th:text="${bug.id}">1</td>
                <td th:text="${bug.project}">Project</td>
                <td th:text="${bug.bugNumber}">BUG-003</td>
                <td th:text="${bug.issue}">Issue</td>
                <td th:text="${bug.severity}"
                    th:class="${'severity-' + bug.severity.name().toLowerCase()}">S3</td>
                <td th:text="${bug.priority}"
                    th:class="${'priority-' + bug.priority.name().toLowerCase()}">P3</td>
                <td th:text="${bug.remarks}">Notes</td>
                <td class="actions">
                    <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                    <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                       onclick="return confirm('Delete this bug?');">Delete</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(resolvedBugs)}">
                <td colspan="8">No resolved bugs.</td>
            </tr>
        </tbody>
    </table>

</body>
</html>
