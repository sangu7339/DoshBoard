<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bug Tracking Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .dashboard-container { max-width: 1200px; margin: 0 auto; }
        .charts-row { display: flex; justify-content: space-between; margin-bottom: 30px; gap: 15px; }
        .chart-container { 
            flex: 1; 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 300px;
        }
        .chart-container.total-chart {
            max-width: 100%;
            width: 100%;
        }
        .chart-container h3 { 
            text-align: center; 
            margin: 0 0 15px 0; 
            color: #333; 
            font-size: 14px;
            font-weight: bold;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .no-data-message {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 100px;
            font-size: 14px;
        }
        .debug-info {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            display: none;
        }
        table { border-collapse: collapse; width: 100%; margin-bottom: 24px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        th { background: #f7f7f7; font-weight: bold; }
        h1 { margin-bottom: 8px; color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .actions a { margin-right: 8px; text-decoration: none; font-size: 11px; }
        .actions a:hover { text-decoration: underline; }
        .toolbar { margin: 12px 0 20px; text-align: center; }
        .add-btn { 
            background: #28a745; 
            color: white; 
            padding: 10px 15px; 
            text-decoration: none; 
            border-radius: 4px;
            font-weight: bold;
        }
        .add-btn:hover { background: #218838; }
        .debug-btn {
            background: #6c757d;
            color: white;
            padding: 8px 12px;
            text-decoration: none;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 12px;
        }
        .debug-btn:hover { background: #545b62; }
        .edit-btn { color: #007bff; }
        .delete-btn { color: #dc3545; }
        .severity-s1 { color: #dc3545; font-weight: bold; }
        .severity-s2 { color: #fd7e14; font-weight: bold; }
        .severity-s3 { color: #28a745; font-weight: bold; }
        .priority-p1 { color: #dc3545; font-weight: bold; }
        .priority-p2 { color: #fd7e14; font-weight: bold; }
        .priority-p3 { color: #28a745; font-weight: bold; }
        .applicable { color: #28a745; font-weight: bold; }
        .not-applicable { color: #6c757d; }
        .applicability-cell { font-size: 10px; }
        .summary-stats { 
            display: flex; 
            justify-content: space-around; 
            margin: 20px 0; 
            gap: 15px;
        }
        .stat-box { 
            flex: 1;
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1>üêõ Bug Tracking Dashboard</h1>

        <div class="toolbar">
            <a href="/bugs/add" class="add-btn">+ Add New Bug</a>
            <a href="/debug-chart" target="_blank" class="debug-btn">Debug Data</a>
        </div>

        <!-- Summary Statistics -->
        <div class="summary-stats">
            <div class="stat-box">
                <div class="stat-number" th:text="${stats.inDev}">0</div>
                <div class="stat-label">In Development</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" th:text="${stats.inQA}">0</div>
                <div class="stat-label">In QA</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" th:text="${stats.totalLive}">0</div>
                <div class="stat-label">Total Live</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" th:text="${stats.resolved}">0</div>
                <div class="stat-label">Resolved</div>
            </div>
        </div>

        <!-- Debug Information -->
        <div class="debug-info" id="debugInfo">
            <strong>Debug Info:</strong> Loading chart data...
        </div>

        <!-- Total Live Issues Chart (Full Width) -->
        <div class="charts-row">
            <div class="chart-container total-chart">
                <h3>üî• Total Live Issues (Dev + QA) - Stacked Severity & Priority</h3>
                <div class="chart-wrapper">
                    <canvas id="totalLiveChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Stage-Specific Charts -->
        <div class="charts-row">
            <div class="chart-container">
                <h3>üìä In Development - Stacked Severity & Priority</h3>
                <div class="chart-wrapper">
                    <canvas id="inDevChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>üîç In QA - Stacked Severity & Priority</h3>
                <div class="chart-wrapper">
                    <canvas id="inQAChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h3>‚úÖ Resolved - Stacked Severity & Priority</h3>
                <div class="chart-wrapper">
                    <canvas id="resolvedChart"></canvas>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            // Enhanced data handling with null checks
            var chartData = /*[[${chartData}]]*/ null;
            var totalChartData = /*[[${totalChartData}]]*/ null;
            
            // Debug output
            console.log("=== CHART DATA ANALYSIS ===");
            console.log("Chart Data:", chartData);
            console.log("Total Chart Data:", totalChartData);
            
            // Update debug info
            document.getElementById('debugInfo').innerHTML = 
                '<strong>Debug Info:</strong> Chart data loaded - ' + 
                (chartData ? 'Has chart data' : 'No chart data') + 
                ', ' + (totalChartData ? 'Has total data' : 'No total data') +
                ' | <a href="/debug-chart" target="_blank">View Raw Data</a>';
            document.getElementById('debugInfo').style.display = 'block';

            // Industry-standard color scheme for severity and priority
            const chartColors = {
                severity: {
                    S1: { bg: 'rgba(220, 53, 69, 0.8)', border: 'rgba(220, 53, 69, 1)' },      // Red
                    S2: { bg: 'rgba(253, 126, 20, 0.8)', border: 'rgba(253, 126, 20, 1)' },    // Orange
                    S3: { bg: 'rgba(255, 193, 7, 0.8)', border: 'rgba(255, 193, 7, 1)' }       // Yellow
                },
                priority: {
                    P1: { bg: 'rgba(111, 66, 193, 0.8)', border: 'rgba(111, 66, 193, 1)' },    // Purple
                    P2: { bg: 'rgba(13, 110, 253, 0.8)', border: 'rgba(13, 110, 253, 1)' },    // Blue
                    P3: { bg: 'rgba(32, 201, 151, 0.8)', border: 'rgba(32, 201, 151, 1)' }     // Teal
                }
            };

            // Data normalization with fallbacks
            function normalizeData(data) {
                if (!data) return null;
                
                const defaultValues = {S1: 0, S2: 0, S3: 0, P1: 0, P2: 0, P3: 0};
                const users = ['admin', 'newUser', 'sales', 'partner'];
                
                users.forEach(user => {
                    if (!data[user]) {
                        data[user] = {...defaultValues};
                    } else {
                        Object.keys(defaultValues).forEach(key => {
                            if (data[user][key] === undefined || data[user][key] === null) {
                                data[user][key] = 0;
                            }
                        });
                    }
                });
                
                return data;
            }

            // Function to combine Dev + QA data for Total Live Issues
            function combineLiveData(devData, qaData) {
                if (!devData && !qaData) return null;
                
                const defaultValues = {S1: 0, S2: 0, S3: 0, P1: 0, P2: 0, P3: 0};
                const users = ['admin', 'newUser', 'sales', 'partner'];
                const combinedData = {};
                
                users.forEach(user => {
                    combinedData[user] = {...defaultValues};
                    
                    // Add Dev data
                    if (devData && devData[user]) {
                        Object.keys(defaultValues).forEach(key => {
                            combinedData[user][key] += devData[user][key] || 0;
                        });
                    }
                    
                    // Add QA data
                    if (qaData && qaData[user]) {
                        Object.keys(defaultValues).forEach(key => {
                            combinedData[user][key] += qaData[user][key] || 0;
                        });
                    }
                });
                
                return combinedData;
            }

            // Create stacked datasets - S1+S2+S3 in one stack, P1+P2+P3 in another stack
            function createCombinedDatasets(data) {
                if (!data) return [];
                
                return [
                    // Severity Stack - S1 (bottom layer)
                    {
                        label: 'S1 (Critical)',
                        data: [data.admin?.S1||0, data.newUser?.S1||0, data.sales?.S1||0, data.partner?.S1||0],
                        backgroundColor: chartColors.severity.S1.bg,
                        borderColor: chartColors.severity.S1.border,
                        borderWidth: 1,
                        stack: 'severity'
                    },
                    // Severity Stack - S2 (middle layer)
                    {
                        label: 'S2 (Major)',
                        data: [data.admin?.S2||0, data.newUser?.S2||0, data.sales?.S2||0, data.partner?.S2||0],
                        backgroundColor: chartColors.severity.S2.bg,
                        borderColor: chartColors.severity.S2.border,
                        borderWidth: 1,
                        stack: 'severity'
                    },
                    // Severity Stack - S3 (top layer)
                    {
                        label: 'S3 (Minor)',
                        data: [data.admin?.S3||0, data.newUser?.S3||0, data.sales?.S3||0, data.partner?.S3||0],
                        backgroundColor: chartColors.severity.S3.bg,
                        borderColor: chartColors.severity.S3.border,
                        borderWidth: 1,
                        stack: 'severity'
                    },
                    // Priority Stack - P1 (bottom layer)
                    {
                        label: 'P1 (Critical)',
                        data: [data.admin?.P1||0, data.newUser?.P1||0, data.sales?.P1||0, data.partner?.P1||0],
                        backgroundColor: chartColors.priority.P1.bg,
                        borderColor: chartColors.priority.P1.border,
                        borderWidth: 1,
                        stack: 'priority'
                    },
                    // Priority Stack - P2 (middle layer)
                    {
                        label: 'P2 (High)',
                        data: [data.admin?.P2||0, data.newUser?.P2||0, data.sales?.P2||0, data.partner?.P2||0],
                        backgroundColor: chartColors.priority.P2.bg,
                        borderColor: chartColors.priority.P2.border,
                        borderWidth: 1,
                        stack: 'priority'
                    },
                    // Priority Stack - P3 (top layer)
                    {
                        label: 'P3 (Medium)',
                        data: [data.admin?.P3||0, data.newUser?.P3||0, data.sales?.P3||0, data.partner?.P3||0],
                        backgroundColor: chartColors.priority.P3.bg,
                        borderColor: chartColors.priority.P3.border,
                        borderWidth: 1,
                        stack: 'priority'
                    }
                ];
            }

            // Chart initialization with error handling
            function initChart(canvasId, rawData, title) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error(`Canvas not found: ${canvasId}`);
                    return;
                }
                
                // Clear previous instance
                if (window[`${canvasId}Instance`]) {
                    window[`${canvasId}Instance`].destroy();
                }
                
                const container = canvas.parentNode;
                const normalizedData = normalizeData(rawData);
                
                if (!normalizedData) {
                    container.innerHTML = `
                        <div class="no-data-message">
                            üìä No data available
                            <br><small style="margin-top:10px;display:block;">Add bugs to see stacked severity & priority</small>
                        </div>
                    `;
                    return;
                }
                
                // Check if there's any data to display
                const datasets = createCombinedDatasets(normalizedData);
                const hasData = datasets.some(dataset => 
                    dataset.data.some(value => value > 0)
                );
                
                if (!hasData) {
                    container.innerHTML = `
                        <div class="no-data-message">
                            üìä No issues found
                            <br><small style="margin-top:10px;display:block;">This stage has no bugs to display</small>
                        </div>
                    `;
                    return;
                }
                
                try {
                    window[`${canvasId}Instance`] = new Chart(canvas.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Admin', 'New User', 'Sales', 'Partner'],
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: title,
                                    font: { size: 14, weight: 'bold' },
                                    padding: { bottom: 20 }
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: { 
                                        padding: 15,
                                        usePointStyle: true,
                                        pointStyle: 'rect',
                                        font: { size: 11 }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        title: function(context) {
                                            return context[0].label + ' User Type';
                                        },
                                        afterBody: function(context) {
                                            const userIndex = context.dataIndex;
                                            const users = ['admin', 'newUser', 'sales', 'partner'];
                                            const userData = normalizedData[users[userIndex]];
                                            
                                            if (!userData) return '';
                                            
                                            const severityTotal = (userData.S1 || 0) + (userData.S2 || 0) + (userData.S3 || 0);
                                            const priorityTotal = (userData.P1 || 0) + (userData.P2 || 0) + (userData.P3 || 0);
                                            
                                            return [
                                                '',
                                                '--- Severity Stack ---',
                                                `S1 (Critical): ${userData.S1 || 0}`,
                                                `S2 (Major): ${userData.S2 || 0}`,
                                                `S3 (Minor): ${userData.S3 || 0}`,
                                                `Total Severity: ${severityTotal}`,
                                                '',
                                                '--- Priority Stack ---',
                                                `P1 (Critical): ${userData.P1 || 0}`,
                                                `P2 (High): ${userData.P2 || 0}`,
                                                `P3 (Medium): ${userData.P3 || 0}`,
                                                `Total Priority: ${priorityTotal}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    stacked: true,
                                    ticks: {
                                        stepSize: 1,
                                        precision: 0
                                    },
                                    title: {
                                        display: true,
                                        text: 'Number of Issues'
                                    }
                                },
                                x: {
                                    stacked: true,
                                    title: {
                                        display: true,
                                        text: 'User Types'
                                    }
                                }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            }
                        }
                    });
                } catch (error) {
                    console.error(`Chart error for ${canvasId}:`, error);
                    container.innerHTML = `
                        <div class="no-data-message" style="color:#dc3545">
                            ‚ö†Ô∏è Chart rendering failed
                            <br><small style="margin-top:10px;display:block;">Error: ${error.message}</small>
                        </div>
                    `;
                }
            }

            // Main initialization
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    // Create Total Live Issues chart (Dev + QA combined)
                    if (chartData?.stageData) {
                        const liveData = combineLiveData(
                            chartData.stageData.inDev, 
                            chartData.stageData.inQA
                        );
                        initChart('totalLiveChart', liveData, 'Total Live Issues (Dev + QA Combined) - By User Type');
                    } else {
                        const el = document.getElementById('totalLiveChart');
                        if (el) {
                            el.parentNode.innerHTML = `
                                <div class="no-data-message">
                                    üìä No live issues data available
                                    <br><small style="margin-top:10px;display:block;">Add bugs in Dev or QA to see the chart</small>
                                </div>
                            `;
                        }
                    }
                    
                    // Initialize stage charts
                    if (chartData?.stageData) {
                        initChart('inDevChart', chartData.stageData.inDev, 'In Development - Stacked Distribution');
                        initChart('inQAChart', chartData.stageData.inQA, 'In QA - Stacked Distribution');
                        initChart('resolvedChart', chartData.stageData.resolved, 'Resolved - Stacked Distribution');
                    } else {
                        ['inDevChart', 'inQAChart', 'resolvedChart'].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) {
                                el.parentNode.innerHTML = `
                                    <div class="no-data-message">
                                        üìä No stage data available
                                        <br><small style="margin-top:10px;display:block;">Check your data source</small>
                                    </div>
                                `;
                            }
                        });
                    }
                } catch (error) {
                    console.error("Initialization failed:", error);
                    document.getElementById('debugInfo').innerHTML += 
                        `<br><strong style="color:#dc3545">Error: ${error.message}</strong>`;
                }
            });
            /*]]>*/
        </script>

        <hr style="margin: 40px 0;"/>

        <!-- Section: In Dev -->
        <h2>üîß In Development (<span th:text="${#lists.size(inDevBugs)}">0</span>)</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Project</th>
                    <th>Bug #</th>
                    <th>Issue</th>
                    <th>Severity</th>
                    <th>Priority</th>
                    <th>New User</th>
                    <th>Partner</th>
                    <th>Admin</th>
                    <th>Sales</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="bug : ${inDevBugs}">
                    <td th:text="${bug.id}">1</td>
                    <td th:text="${bug.project}">Project</td>
                    <td th:text="${bug.bugNumber}">BUG-001</td>
                    <td th:text="${bug.issue}">Issue</td>
                    <td th:text="${bug.severity}" 
                        th:class="${'severity-' + bug.severity.name().toLowerCase()}">S1</td>
                    <td th:text="${bug.priority}"
                        th:class="${'priority-' + bug.priority.name().toLowerCase()}">P1</td>
                    <td class="applicability-cell" 
                        th:class="${bug.newUser == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.newUser == 'APPLICABLE' ? 'Y' : bug.newUser == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.partner == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.partner == 'APPLICABLE' ? 'Y' : bug.partner == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.admin == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.admin == 'APPLICABLE' ? 'Y' : bug.admin == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.sales == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.sales == 'APPLICABLE' ? 'Y' : bug.sales == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td th:text="${bug.remarks}">Notes</td>
                    <td class="actions">
                        <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                        <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                           onclick="return confirm('Delete this bug?');">Delete</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(inDevBugs)}">
                    <td colspan="12" style="text-align: center; color: #666; font-style: italic;">No bugs in development.</td>
                </tr>
            </tbody>
        </table>

        <!-- Section: In QA -->
        <h2>üîç In QA (<span th:text="${#lists.size(inQaBugs)}">0</span>)</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Project</th>
                    <th>Bug #</th>
                    <th>Issue</th>
                    <th>Severity</th>
                    <th>Priority</th>
                    <th>New User</th>
                    <th>Partner</th>
                    <th>Admin</th>
                    <th>Sales</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="bug : ${inQaBugs}">
                    <td th:text="${bug.id}">1</td>
                    <td th:text="${bug.project}">Project</td>
                    <td th:text="${bug.bugNumber}">BUG-002</td>
                    <td th:text="${bug.issue}">Issue</td>
                    <td th:text="${bug.severity}"
                        th:class="${'severity-' + bug.severity.name().toLowerCase()}">S2</td>
                    <td th:text="${bug.priority}"
                        th:class="${'priority-' + bug.priority.name().toLowerCase()}">P2</td>
                    <td class="applicability-cell" 
                        th:class="${bug.newUser == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.newUser == 'APPLICABLE' ? 'Y' : bug.newUser == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.partner == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.partner == 'APPLICABLE' ? 'Y' : bug.partner == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.admin == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.admin == 'APPLICABLE' ? 'Y' : bug.admin == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.sales == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.sales == 'APPLICABLE' ? 'Y' : bug.sales == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td th:text="${bug.remarks}">Notes</td>
                    <td class="actions">
                        <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                        <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                           onclick="return confirm('Delete this bug?');">Delete</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(inQaBugs)}">
                    <td colspan="12" style="text-align: center; color: #666; font-style: italic;">No bugs in QA.</td>
                </tr>
            </tbody>
        </table>

        <!-- Section: Resolved -->
        <h2>‚úÖ Resolved (<span th:text="${#lists.size(resolvedBugs)}">0</span>)</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Project</th>
                    <th>Bug #</th>
                    <th>Issue</th>
                    <th>Severity</th>
                    <th>Priority</th>
                    <th>New User</th>
                    <th>Partner</th>
                    <th>Admin</th>
                    <th>Sales</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="bug : ${resolvedBugs}">
                    <td th:text="${bug.id}">1</td>
                    <td th:text="${bug.project}">Project</td>
                    <td th:text="${bug.bugNumber}">BUG-003</td>
                    <td th:text="${bug.issue}">Issue</td>
                    <td th:text="${bug.severity}"
                        th:class="${'severity-' + bug.severity.name().toLowerCase()}">S3</td>
                    <td th:text="${bug.priority}"
                        th:class="${'priority-' + bug.priority.name().toLowerCase()}">P3</td>
                    <td class="applicability-cell" 
                        th:class="${bug.newUser == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.newUser == 'APPLICABLE' ? 'Y' : bug.newUser == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.partner == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.partner == 'APPLICABLE' ? 'Y' : bug.partner == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.admin == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.admin == 'APPLICABLE' ? 'Y' : bug.admin == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td class="applicability-cell" 
                        th:class="${bug.sales == 'APPLICABLE' ? 'applicable' : 'not-applicable'}"
                        th:text="${bug.sales == 'APPLICABLE' ? 'Y' : bug.sales == 'NOT_APPLICABLE' ? 'N' : ''}">-</td>
                    <td th:text="${bug.remarks}">Notes</td>
                    <td class="actions">
                        <a th:href="@{'/bugs/edit/' + ${bug.id}}" class="edit-btn">Edit</a>
                        <a th:href="@{'/bugs/delete/' + ${bug.id}}" class="delete-btn"
                           onclick="return confirm('Delete this bug?');">Delete</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(resolvedBugs)}">
                    <td colspan="12" style="text-align: center; color: #666; font-style: italic;">No resolved bugs.</td>
                </tr>
            </tbody>
        </table>

    </div>
</body>
</html>
