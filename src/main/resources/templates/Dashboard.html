<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OfferBeez Dashboard - VentureBeez</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>
<body>
    <div class="container-fluid">
        <header class="bg-primary text-white p-3 mb-4 position-relative">
            <h1>üöÄ OfferBeez Dashboard - VentureBeez</h1>
            <div class="overall-status" th:classappend="${overallStatus == 'NEGATIVE'} ? 'negative' : 'positive'">
                <span th:text="${overallStatus == 'NEGATIVE'} ? '‚ùå NEGATIVE' : '‚úÖ POSITIVE'"></span>
            </div>
        </header>

        <!-- Charts Section -->
        <div class="row mb-4">
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <h5>üîß Development Status</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="devChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5>üß™ QA Status</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="qaChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5>üî¥ Live Status</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="liveChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-6 col-md-12 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-danger text-white">
                        <h5>‚ö†Ô∏è Severity Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="severityChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-12 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-secondary text-white">
                        <h5>üìã Priority Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="priorityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add New Item Form -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5>‚ûï Add New Dashboard Item</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/add}" method="post" th:object="${newItem}">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">Project</label>
                            <input type="text" class="form-control" th:field="*{project}" required>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Bug Number</label>
                            <input type="text" class="form-control" th:field="*{bugNumber}" required>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Severity</label>
                            <select class="form-control severity-select" th:field="*{severity}" required>
                                <option value="">Select</option>
                                <option value="S1">S1 - Critical</option>
                                <option value="S2">S2 - High</option>
                                <option value="S3">S3 - Medium</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Priority</label>
                            <select class="form-control priority-select" th:field="*{priority}" required>
                                <option value="">Select</option>
                                <option value="P1">P1 - High</option>
                                <option value="P2">P2 - Medium</option>
                                <option value="P3">P3 - Low</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">Issue Description</label>
                            <input type="text" class="form-control" th:field="*{issue}" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">New User</label>
                            <select class="form-control" th:field="*{newUser}">
                                <option value="Applicable">Applicable</option>
                                <option value="Not Applicable">Not Applicable</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">Partner</label>
                            <select class="form-control" th:field="*{partner}">
                                <option value="Applicable">Applicable</option>
                                <option value="Not Applicable">Not Applicable</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">Admin</label>
                            <select class="form-control" th:field="*{admin}">
                                <option value="Applicable">Applicable</option>
                                <option value="Not Applicable">Not Applicable</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <label class="form-label">Sales</label>
                            <select class="form-control" th:field="*{sales}">
                                <option value="Applicable">Applicable</option>
                                <option value="Not Applicable">Not Applicable</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-control" th:field="*{status}">
                                <option value="In Dev">In Dev</option>
                                <option value="In QA">In QA</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Live</label>
                            <select class="form-control" th:field="*{live}">
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">In Dev</label>
                            <select class="form-control" th:field="*{inDev}">
                                <option value="open">Open</option>
                                <option value="pass">Pass</option>
                                <option value="fail">Fail</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">In QA</label>
                            <select class="form-control" th:field="*{inQA}">
                                <option value="open">Open</option>
                                <option value="pass">Pass</option>
                                <option value="fail">Fail</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Reopen</label>
                            <select class="form-control" th:field="*{reopen}">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6 mb-3">
                            <label class="form-label">Verify & Closed</label>
                            <select class="form-control" th:field="*{verifyAndClosed}">
                                <option value="pending">Pending</option>
                                <option value="pass">Pass</option>
                                <option value="fail">Fail</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label">Remarks</label>
                            <textarea class="form-control" th:field="*{remarks}" rows="2" placeholder="Add any additional notes or comments..."></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary btn-lg">‚ûï Add Item</button>
                        <button type="reset" class="btn btn-secondary btn-lg ms-2">üîÑ Reset</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dashboard Table -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5>üìä Dashboard Items Overview</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Project</th>
                                <th>Bug#</th>
                                <th>Issue</th>
                                <th>Severity</th>
                                <th>Priority</th>
                                <th>New User</th>
                                <th>Partner</th>
                                <th>Admin</th>
                                <th>Sales</th>
                                <th>Status</th>
                                <th>Live</th>
                                <th>In Dev</th>
                                <th>In QA</th>
                                <th>Reopen</th>
                                <th>Verify & Closed</th>
                                <th>Remarks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item : ${dashboardItems}" th:if="${dashboardItems != null and !dashboardItems.isEmpty()}">
                                <td th:text="${item.id}"></td>
                                <td th:text="${item.project}"></td>
                                <td th:text="${item.bugNumber}"></td>
                                <td th:text="${item.issue}"></td>
                                <td>
                                    <span th:text="${item.severity}" 
                                          th:class="${item.severity == 'S1'} ? 'badge bg-danger' : (${item.severity == 'S2'} ? 'badge bg-warning text-dark' : 'badge bg-success')"></span>
                                </td>
                                <td>
                                    <span th:text="${item.priority}" 
                                          th:class="${item.priority == 'P1'} ? 'badge bg-danger' : (${item.priority == 'P2'} ? 'badge bg-warning text-dark' : 'badge bg-success')"></span>
                                </td>
                                <td>
                                    <span th:text="${item.newUser}" 
                                          th:class="${item.newUser == 'Applicable'} ? 'badge bg-info' : 'badge bg-secondary'"></span>
                                </td>
                                <td>
                                    <span th:text="${item.partner}" 
                                          th:class="${item.partner == 'Applicable'} ? 'badge bg-info' : 'badge bg-secondary'"></span>
                                </td>
                                <td>
                                    <span th:text="${item.admin}" 
                                          th:class="${item.admin == 'Applicable'} ? 'badge bg-info' : 'badge bg-secondary'"></span>
                                </td>
                                <td>
                                    <span th:text="${item.sales}" 
                                          th:class="${item.sales == 'Applicable'} ? 'badge bg-info' : 'badge bg-secondary'"></span>
                                </td>
                                <td th:text="${item.status}"></td>
                                <td>
                                    <span th:text="${item.live} ? 'üî¥ Live' : '‚ö´ Previous'" 
                                          th:class="${item.live} ? 'badge bg-success' : 'badge bg-secondary'"></span>
                                </td>
                                <td>
                                    <span th:text="${item.inDev}" 
                                          th:class="${item.inDev == 'pass'} ? 'badge bg-success' : (${item.inDev == 'fail'} ? 'badge bg-danger' : 'badge bg-warning text-dark')"></span>
                                </td>
                                <td>
                                    <span th:text="${item.inQA}" 
                                          th:class="${item.inQA == 'pass'} ? 'badge bg-success' : (${item.inQA == 'fail'} ? 'badge bg-danger' : 'badge bg-warning text-dark')"></span>
                                </td>
                                <td>
                                    <span th:text="${item.reopen}" 
                                          th:class="${item.reopen == 'yes'} ? 'badge bg-danger' : 'badge bg-success'"></span>
                                </td>
                                <td>
                                    <span th:text="${item.verifyAndClosed}" 
                                          th:class="${item.verifyAndClosed == 'pass'} ? 'badge bg-success' : (${item.verifyAndClosed == 'fail'} ? 'badge bg-danger' : 'badge bg-warning text-dark')"></span>
                                </td>
                                <td th:text="${item.remarks}" class="text-muted"></td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/edit/{id}(id=${item.id})}" class="btn btn-sm btn-outline-primary" title="Edit">‚úèÔ∏è</a>
                                        <a th:href="@{/delete/{id}(id=${item.id})}" class="btn btn-sm btn-outline-danger" 
                                           onclick="return confirm('Are you sure you want to delete this item?')" title="Delete">üóëÔ∏è</a>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${dashboardItems == null or dashboardItems.isEmpty()}">
                                <td colspan="18" class="text-center text-muted py-4">
                                    <h5>üì≠ No data available</h5>
                                    <p>Start by adding your first dashboard item above!</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/dashboard.js}"></script>
    <script th:inline="javascript">
        // Pass data from Thymeleaf to JavaScript
        const devStats = /*[[${devStats}]]*/ {};
        const qaStats = /*[[${qaStats}]]*/ {};
        const liveStats = /*[[${liveStats}]]*/ {};
        const severityStats = /*[[${severityStats}]]*/ {};
        const priorityStats = /*[[${priorityStats}]]*/ {};
        
        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts(devStats, qaStats, liveStats, severityStats, priorityStats);
        });
    </script>
</body>
</html>
